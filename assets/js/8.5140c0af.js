(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{624:function(e,t,a){e.exports=a.p+"assets/img/serial-header.f60954b5.png"},625:function(e,t,a){e.exports=a.p+"assets/img/serial-connector.6e514758.jpg"},626:function(e,t,a){e.exports=a.p+"assets/img/817DNdBZDkL._AC_SL1500_.af22055f.jpg"},627:function(e,t,a){e.exports=a.p+"assets/img/61yHczOwpTL._AC_SL1001_.f84613fd.jpg"},628:function(e,t,a){e.exports=a.p+"assets/img/coolterm-first-start.9ab65697.png"},629:function(e,t,a){e.exports=a.p+"assets/img/coolterm-settings.2c1445fe.png"},630:function(e,t,a){e.exports=a.p+"assets/img/coolterm-connect.fb665577.png"},631:function(e,t,a){e.exports=a.p+"assets/img/coolterm-record.f7e0709b.png"},632:function(e,t,a){e.exports=a.p+"assets/img/more-downloads.edd8905d.png"},633:function(e,t,a){e.exports=a.p+"assets/img/kdk-install.015e9b14.png"},634:function(e,t,a){e.exports=a.p+"assets/img/kdk-installed.41bf377f.png"},725:function(e,t,a){"use strict";a.r(t);var s=a(35),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"system-debugging-in-depth"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#system-debugging-in-depth"}},[e._v("#")]),e._v(" System Debugging: In-depth")]),e._v(" "),s("p",[e._v("This section will go a bit deeper into the troubleshooting rabbit hole, specifically focusing on more low level debugging with proper debug output and optional serial setup.")]),e._v(" "),s("p",[s("strong",[e._v("Note")]),e._v(": 99% of users do not need this level of debugging, this is only for the hardcore or extreme edge-cases.")]),e._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#efi-setup"}},[e._v("EFI Setup")])]),s("li",[s("a",{attrs:{href:"#config-plist-setup"}},[e._v("Config.plist Setup")]),s("ul",[s("li",[s("a",{attrs:{href:"#misc"}},[e._v("Misc")])]),s("li",[s("a",{attrs:{href:"#nvram"}},[e._v("NVRAM")])])])]),s("li",[s("a",{attrs:{href:"#serial-setup-optional"}},[e._v("Serial Setup(Optional)")]),s("ul",[s("li",[s("a",{attrs:{href:"#hardware-setup"}},[e._v("Hardware Setup")])]),s("li",[s("a",{attrs:{href:"#coolterm-setup"}},[e._v("CoolTerm Setup")])])])]),s("li",[s("a",{attrs:{href:"#kernel-debug-kits-optional"}},[e._v("Kernel Debug Kits (Optional)")]),s("ul",[s("li",[s("a",{attrs:{href:"#kdk-on-an-installed-os"}},[e._v("KDK on an Installed OS")])]),s("li",[s("a",{attrs:{href:"#uninstalling-the-kdk"}},[e._v("Uninstalling the KDK")])])])])])]),s("p"),e._v(" "),s("h2",{attrs:{id:"efi-setup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#efi-setup"}},[e._v("#")]),e._v(" EFI Setup")]),e._v(" "),s("p",[e._v("For most part, there's fairly minimal changes required. Main things we recommend are DEBUG version of "),s("strong",[e._v("OpenCore")]),e._v(" and all your "),s("strong",[e._v("kexts")]),e._v(". This can help ensure you get all the necessary data, see here for more details on OpenCore debugging: "),s("RouterLink",{attrs:{to:"/troubleshooting/debug.html"}},[e._v("OpenCore debugging")])],1),e._v(" "),s("p",[e._v("Besides just using DEBUG variants of OpenCore and kexts, these tools can also help out greatly:")]),e._v(" "),s("ul",[s("li",[s("p",[s("a",{attrs:{href:"https://github.com/acidanthera/DebugEnhancer/releases",target:"_blank",rel:"noopener noreferrer"}},[e._v("DebugEnhancer.kext"),s("OutboundLink")],1)]),e._v(" "),s("ul",[s("li",[e._v("Helps greatly with kernel debugging while also patching "),s("a",{attrs:{href:"https://github.com/acidanthera/DebugEnhancer/blob/4495911971011a1a7a0ffe8605d6ca4b341f67d9/DebugEnhancer/kern_dbgenhancer.cpp#L131",target:"_blank",rel:"noopener noreferrer"}},[e._v("kern.msgbuf to 10485760"),s("OutboundLink")],1),e._v(" and allowing a much larger kernel-log.")]),e._v(" "),s("li",[e._v("Note this kext cannot start with kernel initialization, so early logs are not patched until the kext is loaded right before PCI Configuration Stage")])])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://gist.github.com/al3xtjames/39ebea4d615c8aed829109a9ea2cd0b5",target:"_blank",rel:"noopener noreferrer"}},[e._v("SSDT-DBG"),s("OutboundLink")],1)]),e._v(" "),s("ul",[s("li",[e._v("Enables debug statements from your ACPI tables, helping for in-OS ACPI event debugging")]),e._v(" "),s("li",[e._v("Note you will need to "),s("a",{attrs:{href:"https://dortania.github.io/Getting-Started-With-ACPI/Manual/compile.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("compile the SSDT"),s("OutboundLink")],1)])])])]),e._v(" "),s("h2",{attrs:{id:"config-plist-setup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#config-plist-setup"}},[e._v("#")]),e._v(" Config.plist Setup")]),e._v(" "),s("p",[e._v("For serial setup, OpenCore actually makes this quite straight forward.")]),e._v(" "),s("h3",{attrs:{id:"misc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#misc"}},[e._v("#")]),e._v(" Misc")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("SerialInit")]),e._v(": YES\n"),s("ul",[s("li",[e._v("Performs serial port initialization")])])]),e._v(" "),s("li",[s("strong",[e._v("Target")]),e._v(": "),s("code",[e._v("67")]),e._v(" "),s("ul",[s("li",[e._v("Enables debug output with OpenCore")]),e._v(" "),s("li",[e._v("Target = 75 adds the additional serial output flag(0x08) if you "),s("a",{attrs:{href:"#serial-setup-optional"}},[e._v("plan to use serial")])]),e._v(" "),s("li",[e._v("You can calculate your own vale here: "),s("RouterLink",{attrs:{to:"/troubleshooting/debug.html"}},[e._v("OpenCore debugging")])],1)])])]),e._v(" "),s("h3",{attrs:{id:"nvram"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nvram"}},[e._v("#")]),e._v(" NVRAM")]),e._v(" "),s("h4",{attrs:{id:"boot-args"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#boot-args"}},[e._v("#")]),e._v(" boot-args")]),e._v(" "),s("p",[e._v("Here we get to set some variables that will help us with debug output, for us we'll be using the following boot-args:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("-v keepsyms=1 debug=0x12a msgbuf=1048576\n")])])]),s("p",[e._v("Now lets go over what each arg does:")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("-v")]),e._v(" "),s("ul",[s("li",[e._v("Enables verbose output")])])]),e._v(" "),s("li",[s("strong",[e._v("keepsyms=1")]),e._v(" "),s("ul",[s("li",[e._v("Ensures symbols are kept during kernel panics, which are greatly helpful for troubleshooting")])])]),e._v(" "),s("li",[s("strong",[e._v("debug=0x12a")]),e._v(" "),s("ul",[s("li",[e._v("Combination of "),s("code",[e._v("DB_KPRT")]),e._v("(0x8), "),s("code",[e._v("DB_KDP_BP_DIS")]),e._v("(0x32), "),s("code",[e._v("DB_KDP_GETC_ENA(0x200)")])]),e._v(" "),s("li",[e._v("A full list of values can be found here: "),s("a",{attrs:{href:"https://github.com/apple/darwin-xnu/blob/master/osfmk/kern/debug.h#L419L447",target:"_blank",rel:"noopener noreferrer"}},[e._v("debug.h"),s("OutboundLink")],1)])])]),e._v(" "),s("li",[s("strong",[e._v("msgbuf=1048576")]),e._v(" "),s("ul",[s("li",[e._v("Sets the kernel's message buffer size, this helps with getting proper logs during boot")]),e._v(" "),s("li",[e._v("1048576 is 1MB(/1024^2), can be larger if required")]),e._v(" "),s("li",[e._v("Note not required with DebugEnhancer.kext, however for early kernel logs it's still required")])])])]),e._v(" "),s("p",[s("strong",[e._v("Other helpful boot-args")]),e._v(":")]),e._v(" "),s("p",[e._v("Depending on what you're debugging, you may also find these boot-args extremely helpful:")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("-liludbgall")]),e._v(" "),s("ul",[s("li",[e._v("Enables debugging on Lilu and any other plugins, though note that this requires DEBUG versions of the kexts")])])]),e._v(" "),s("li",[s("strong",[e._v("io=0xff")]),e._v(" "),s("ul",[s("li",[e._v("Enables IOKit debugging, with greater output. Be aware that the logging-amount of this parameter will be huge and will slow down the system. Especially while booting.")])])]),e._v(" "),s("li",[s("strong",[e._v("igdebug=0xff")]),e._v(" "),s("ul",[s("li",[e._v("Enables iGPU related debugging, helpful when working with iGPU systems")])])]),e._v(" "),s("li",[s("strong",[e._v("serial=5")]),e._v(" "),s("ul",[s("li",[e._v("Redirects output to serial if you "),s("a",{attrs:{href:"#serial-setup-optional"}},[e._v("plan to use serial")])]),e._v(" "),s("li",[e._v("Recommended for early kernel output before PCI Configuration")])])]),e._v(" "),s("li",[s("strong",[e._v("acpi_layer=0x8")]),e._v(" "),s("ul",[s("li",[e._v("Enables "),s("code",[e._v("ACPI_TABLES")]),e._v(" debug, see "),s("a",{attrs:{href:"https://github.com/acpica/acpica/blob/master/source/include/acoutput.h",target:"_blank",rel:"noopener noreferrer"}},[e._v("acoutput.h"),s("OutboundLink")],1),e._v(" for more information")]),e._v(" "),s("li",[s("code",[e._v("0xFFFFFFFF")]),e._v(" alternatively enables all layers")])])]),e._v(" "),s("li",[s("strong",[e._v("acpi_level=0x2")]),e._v(" "),s("ul",[s("li",[e._v("Sets "),s("code",[e._v("ACPI_LV_DEBUG_OBJECT")]),e._v(" debug, see "),s("a",{attrs:{href:"https://github.com/acpica/acpica/blob/master/source/include/acoutput.h",target:"_blank",rel:"noopener noreferrer"}},[e._v("acoutput.h"),s("OutboundLink")],1),e._v(" for more information")]),e._v(" "),s("li",[s("code",[e._v("0xFFFF5F")]),e._v(" alternatively implies "),s("code",[e._v("ACPI_ALL_COMPONENTS")])])])])]),e._v(" "),s("h2",{attrs:{id:"serial-setup-optional"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#serial-setup-optional"}},[e._v("#")]),e._v(" Serial Setup(Optional)")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#hardware-setup"}},[e._v("Hardware Setup")])]),e._v(" "),s("li",[s("a",{attrs:{href:"#efi-setup"}},[e._v("EFI Setup")])]),e._v(" "),s("li",[s("a",{attrs:{href:"#config-plist-setup"}},[e._v("Config.plist Setup")])])]),e._v(" "),s("p",[e._v("While optional, serial can be super helpful in grabbing all the important info flooding your PC. It's also the only way to properly log super early kernel panics(such as things right after "),s("code",[e._v("[EB|#LOG:EXITBS:START]")]),e._v(")")]),e._v(" "),s("p",[e._v("For this setup, you'll need a few things:")]),e._v(" "),s("ul",[s("li",[e._v("A serial header/port on the test machine")]),e._v(" "),s("li",[e._v("A serial-to-serial or serial-to-USB cable")]),e._v(" "),s("li",[e._v("A second machine to receive the serial logging(with either Serial or USB)")]),e._v(" "),s("li",[e._v("Software to monitor the serial output\n"),s("ul",[s("li",[e._v("For this guide, we'll use "),s("a",{attrs:{href:"https://freeware.the-meiers.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("CoolTerm"),s("OutboundLink")],1),e._v(" as it supports macOS, Linux, Windows and even Raspberry Pi's")]),e._v(" "),s("li",[s("code",[e._v("screen")]),e._v(" and other methods are also supported")])])])]),e._v(" "),s("h3",{attrs:{id:"hardware-setup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hardware-setup"}},[e._v("#")]),e._v(" Hardware Setup")]),e._v(" "),s("p",[e._v("For this example, we'll be using an Asus X299-E Strix board which does have a serial header. To verify whether your board comes with one, check the owners or service manual and search for the serial/COM port:")]),e._v(" "),s("p",[s("img",{attrs:{src:a(624),alt:""}})]),e._v(" "),s("p",[e._v("As you can see, we have a COM port on the bottom of our motherboard and even provides us with a diagram for manually hooking up our serial pins if you're not using a 9/10 Pin Serial Header to DB9 adapter.")]),e._v(" "),s("p",[e._v("Alternatively, some machine come with DB9 Serial ports right on the rear IO such as this Dell Optiplex 780 SFF(note that VGA and Serial are "),s("strong",[e._v("not")]),e._v(" the same connector):")]),e._v(" "),s("img",{attrs:{width:"508",alt:"",src:a(625)}}),e._v(" "),s("p",[e._v("For my X299 setup, I'm using a simple "),s("a",{attrs:{href:"https://www.amazon.ca/gp/product/B001Y1F0HW/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&psc=1",target:"_blank",rel:"noopener noreferrer"}},[e._v("Serial header to DB9"),s("OutboundLink")],1),e._v(", then a "),s("a",{attrs:{href:"https://www.amazon.ca/gp/product/B075YGKFC1/ref=ppx_yo_dt_b_asin_title_o00_s01?ie=UTF8&psc=1",target:"_blank",rel:"noopener noreferrer"}},[e._v("DB9 to USB  RS 232 adapter"),s("OutboundLink")],1),e._v(" which finally terminates at my laptop:")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[e._v("Serial header to DB9")]),e._v(" "),s("th",{staticStyle:{"text-align":"left"}},[e._v("DB9 to USB  RS 232 adapter")])])]),e._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("img",{attrs:{src:a(626),alt:""}})]),e._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("img",{attrs:{src:a(627),alt:""}})])])])]),e._v(" "),s("p",[e._v("The OpenCore manual generally recommends CP21202-based UART devices:")]),e._v(" "),s("blockquote",[s("p",[e._v("To obtain the log during boot you can make the use of serial port debugging. Serial port debugging is enabled in Target, e.g. 0xB for onscreen with serial. OpenCore uses 115200 baud rate, 8 data bits, no parity, and 1 stop bit. For macOS your best choice are CP2102-based UART devices. Connect motherboard TX to USB UART RX, and motherboard GND to USB UART GND. Use screen utility to get the output, or download GUI software, such as CoolTerm.\nNote: On several motherboards (and possibly USB UART dongles) PIN naming may be incorrect. It is very common to have GND swapped with RX, thus you have to connect motherboard “TX” to USB UART GND, and motherboard “GND” to USB UART RX.")])]),e._v(" "),s("p",[s("strong",[e._v("Important reminder")]),e._v(": Don't forget to also enable the serial port in your BIOS, most motherboards will disable it by default")]),e._v(" "),s("h3",{attrs:{id:"coolterm-setup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#coolterm-setup"}},[e._v("#")]),e._v(" CoolTerm Setup")]),e._v(" "),s("p",[e._v("Now lets fire up "),s("a",{attrs:{href:"https://freeware.the-meiers.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("CoolTerm"),s("OutboundLink")],1),e._v(" and set a few options. When you open CoolTerm, you'll likely be greeted with a simple window. Here select the Options entry:")]),e._v(" "),s("p",[s("img",{attrs:{src:a(628),alt:""}}),e._v(" "),s("img",{attrs:{src:a(629),alt:""}})]),e._v(" "),s("p",[e._v("Here we're given quite a few options, but the mains ones we care about are:")]),e._v(" "),s("ul",[s("li",[e._v("Port: Ensure this matches with your serial controller.")]),e._v(" "),s("li",[e._v("Baudrate = 115200")]),e._v(" "),s("li",[e._v("Data Bits = 8")]),e._v(" "),s("li",[e._v("Parity = none")]),e._v(" "),s("li",[e._v("Stop Bit = 1")])]),e._v(" "),s("p",[e._v("Next save these settings, and select the Connect entry. This will provide you a live log from serial:")]),e._v(" "),s("p",[s("img",{attrs:{src:a(630),alt:"CoolTerm Connect"}})]),e._v(" "),s("p",[e._v("To record, simply head to "),s("code",[e._v("Connections -> Capture to Text/Binary File -> Start...(Cmd+R)")]),e._v(":")]),e._v(" "),s("p",[s("img",{attrs:{src:a(631),alt:""}})]),e._v(" "),s("h2",{attrs:{id:"kernel-debug-kits-optional"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kernel-debug-kits-optional"}},[e._v("#")]),e._v(" Kernel Debug Kits (Optional)")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#kdk-on-an-installed-os"}},[e._v("KDK on an Installed OS")])]),e._v(" "),s("li",[s("a",{attrs:{href:"#uninstalling-the-kdk"}},[e._v("Uninstalling the KDK")])])]),e._v(" "),s("p",[e._v("Kernel Debug Kits(KDKs) are a great way to get even more logging information from the kernel and core kexts, KDKs specifically are debug versions of macOS's core foundation provided from Apple themselves. They include both more logging as well as ASSERTs allowing you to more directly see issues with your setup. Note however we will not be discussing bridged debugging or "),s("code",[e._v("lldb")]),e._v(" usage.")]),e._v(" "),s("p",[s("span",{staticStyle:{color:"red"}},[e._v(" CAUTION: ")]),e._v(" Installing KDKs on work machines can lead to issues with OS updates as well as bricked installs. Please debug on dedicated macOS installs to avoid data loss")]),e._v(" "),s("p",[e._v("To start, we'll first need a minimum of a "),s("a",{attrs:{href:"https://developer.apple.com/support/compare-memberships/",target:"_blank",rel:"noopener noreferrer"}},[e._v("free developer account"),s("OutboundLink")],1),e._v(" from Apple. Once you've signed up for a minimum of a free tier, you can now access KDKs from the "),s("a",{attrs:{href:"https://developer.apple.com/download/more/",target:"_blank",rel:"noopener noreferrer"}},[e._v("More Downloads page"),s("OutboundLink")],1),e._v(":")]),e._v(" "),s("ul",[s("li",[e._v("Note: Free tiers will be limited to release KDKs, only beta KDKs are provided for "),s("a",{attrs:{href:"https://developer.apple.com/support/compare-memberships/",target:"_blank",rel:"noopener noreferrer"}},[e._v("paid developer accounts"),s("OutboundLink")],1)]),e._v(" "),s("li",[e._v("Note 2: Apple hosts KDKs as far back as OS X 10.5, Leopard so don't worry about your OS not being supported")])]),e._v(" "),s("p",[s("img",{attrs:{src:a(632),alt:""}})]),e._v(" "),s("p",[e._v("To determine which KDK build you need with beta builds, run the following in terminal:")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("sw_vers "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("grep")]),e._v(" BuildVersion\n")])])]),s("p",[e._v('For this, I will be downloading Kernel Debug Kit 11.3 build 20E5186d. Once downloaded, mount the disk image and you\'ll find the KDK installer. By default, the KDK will only install itself for "Performing Two-Machine Debugging" and will provide zero extra benefit on the host machine for kernel debugging by default.')]),e._v(" "),s("h3",{attrs:{id:"kdk-on-an-installed-os"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kdk-on-an-installed-os"}},[e._v("#")]),e._v(" KDK on an Installed OS")]),e._v(" "),s("p",[e._v("To enable debugging on the host machine, you'll need to do the following:")]),e._v(" "),s("ol",[s("li",[e._v("Run the KDK Install pkg")]),e._v(" "),s("li",[e._v("Disable SIP(OS X 10.11+)")]),e._v(" "),s("li",[e._v("Mount root partition as writable(macOS 10.15+)")]),e._v(" "),s("li",[e._v("Install debug kernel and kexts")]),e._v(" "),s("li",[e._v("Update boot-args")]),e._v(" "),s("li",[e._v("Reboot and check your work")])]),e._v(" "),s("h4",{attrs:{id:"_1-run-the-kdk-install-pkg"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-run-the-kdk-install-pkg"}},[e._v("#")]),e._v(" 1. Run the KDK Install pkg")]),e._v(" "),s("p",[e._v("Simply run the pkg as normal:")]),e._v(" "),s("p",[s("img",{attrs:{src:a(633),alt:""}})]),e._v(" "),s("p",[e._v("Once installed, you'll find the KDK components such as the debug kernel located at "),s("code",[e._v("/Library/Developer/KDKs")]),e._v(":")]),e._v(" "),s("p",[s("img",{attrs:{src:a(634),alt:""}})]),e._v(" "),s("h4",{attrs:{id:"_2-disabling-sip"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-disabling-sip"}},[e._v("#")]),e._v(" 2. Disabling SIP")]),e._v(" "),s("ul",[s("li",[e._v("Applicable for OS X 10.11, El Capitan and newer")])]),e._v(" "),s("p",[e._v("To disable SIP, users have 2 choices:")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("Disable via Recovery")])]),e._v(" "),s("li",[s("p",[s("RouterLink",{attrs:{to:"/troubleshooting/extended/post-issues.html#disabling-sip"}},[e._v("Disable via config.plist")])],1)])]),e._v(" "),s("p",[e._v("Generally we highly recommend recovery to easily revert with NVRAM reset, however some users may require SIP to be disabled through NVRAM wipes as well.")]),e._v(" "),s("p",[e._v("For the former, simply reboot into macOS Recovery, open terminal and run the following:")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("csrutil disable\ncsrutil authenticated-root disable "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Big Sur+")]),e._v("\n")])])]),s("p",[e._v("Reboot, and SIP will have been adjusted accordingly. You can run "),s("code",[e._v("csrutil status")]),e._v(" in terminal to verify it worked.")]),e._v(" "),s("ul",[s("li",[s("span",{staticStyle:{color:"red"}},[e._v(" CAUTION: ")]),e._v(" For users relying on "),s("a",{attrs:{href:"https://dortania.github.io/OpenCore-Post-Install/universal/security/applesecureboot.html#apecid",target:"_blank",rel:"noopener noreferrer"}},[e._v("OpenCore's ApECID feature"),s("OutboundLink")],1),e._v(", please be aware this "),s("strong",[e._v("must")]),e._v(" be disabled to use the KDK.")])]),e._v(" "),s("h4",{attrs:{id:"_3-mount-root-partition-as-writable"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-mount-root-partition-as-writable"}},[e._v("#")]),e._v(" 3. Mount root partition as writable")]),e._v(" "),s("ul",[s("li",[e._v("Applicable for macOS 10.15, Catalina and newer")])]),e._v(" "),s("p",[e._v("Mounting the root volume as writable is easy, however the process is a bit long:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Big Sur+")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# First, create a mount point for your drive")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" ~/livemount\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Next, find your System volume")]),e._v("\ndiskutil list\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# From the below list, we can see our System volume is disk5s5")]),e._v("\n/dev/disk5 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("synthesized"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(":\n   "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#:                       TYPE NAME                    SIZE       IDENTIFIER")]),e._v("\n   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(":      APFS Container Scheme -                      +255.7 GB   disk5\n                                 Physical Store disk4s2\n   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(":                APFS Volume ⁨Big Sur HD - Data⁩       "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("122.5")]),e._v(" GB   disk5s1\n   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(":                APFS Volume ⁨Preboot⁩                 "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("309.4")]),e._v(" MB   disk5s2\n   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v(":                APFS Volume ⁨Recovery⁩                "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("887.8")]),e._v(" MB   disk5s3\n   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),e._v(":                APFS Volume ⁨VM⁩                      "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1.1")]),e._v(" MB     disk5s4\n   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("5")]),e._v(":                APFS Volume ⁨Big Sur HD⁩              "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("16.2")]),e._v(" GB    disk5s5\n   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("6")]),e._v(":              APFS Snapshot ⁨com.apple.os.update-"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".⁩ "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("16.2")]),e._v(" GB    disk5s5s\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Mount the drive(ie. disk5s5)")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mount")]),e._v(" -o nobrowse -t apfs  /dev/disk5s5 ~/livemount\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Now you can freely make any edits to the System volume")]),e._v("\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Catalina only")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mount")]),e._v(" -uw /\n")])])]),s("h4",{attrs:{id:"_4-install-debug-kernel-and-kexts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-install-debug-kernel-and-kexts"}},[e._v("#")]),e._v(" 4. Install debug kernel and kexts")]),e._v(" "),s("p",[e._v("Now we install our KDK into the system:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Install KDK to System Volume")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Ensure to replace <KDK Version>")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# For 10.15 and older, swap livemount with /Volumes/<Target Volume>")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" ditto /Library/Developer/KDKs/"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("KDK Version"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("/System ~/livemount/System\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Rebuild the kernel cache(Big Sur and newer)")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" kmutil "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" --volume-root ~/livemount --update-all\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Rebuild the kernel cache(Catalina and older)")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" kextcache -invalidate /Volumes/"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("Target Volume"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Finally, once done editing the system volume")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# we'll want to create a new snapshot (Big Sur and newer)")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" bless --folder ~/livemount/System/Library/CoreServices --bootefi --create-snapshot\n")])])]),s("h4",{attrs:{id:"_5-update-boot-args"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-update-boot-args"}},[e._v("#")]),e._v(" 5. Update boot-args")]),e._v(" "),s("p",[e._v("Now that you've finished setting up the KDK and installed it, we now need to tell boot.efi which kernel to use. You have 2 options to choose from:")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("kcsuffix=debug")]),e._v(" (removed with Big Sur)")]),e._v(" "),s("li",[s("code",[e._v("kcsuffix=development")])]),e._v(" "),s("li",[s("code",[e._v("kcsuffix=kasan")])])]),e._v(" "),s("p",[s("code",[e._v("development")]),e._v(" arg will set the new default debug kernel in Big Sur, while "),s("code",[e._v("kasan")]),e._v(" is a much more logging intensive kernel that incorporates "),s("a",{attrs:{href:"https://github.com/google/sanitizers/wiki/AddressSanitizer",target:"_blank",rel:"noopener noreferrer"}},[e._v("AddressSanitizer"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("p",[e._v("Once you've decided which kernel is ideal for you, add the kcsuffix arg to your boot-args in your config.plist")]),e._v(" "),s("h4",{attrs:{id:"_6-reboot-and-check-your-work"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-reboot-and-check-your-work"}},[e._v("#")]),e._v(" 6. Reboot and check your work")]),e._v(" "),s("p",[e._v("Assuming everything was done correctly, you'll now want to reboot and check that the correct kernel was booted:")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("sysctl kern.osbuildconfig\n kern.osbuildconfig: kasan\n")])])]),s("p",[e._v("And as we can see, we're successfully booting a KASAN kernel.")]),e._v(" "),s("h3",{attrs:{id:"uninstalling-the-kdk"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#uninstalling-the-kdk"}},[e._v("#")]),e._v(" Uninstalling the KDK")]),e._v(" "),s("p",[e._v("Uninstalling the KDK is fairly simple, however can be a bit destructive if not care.")]),e._v(" "),s("ol",[s("li",[e._v("Mount root partition as writable(macOS 10.15+)")]),e._v(" "),s("li",[e._v("Remove debug kernel and kexts")]),e._v(" "),s("li",[e._v("Re-enable SIP")]),e._v(" "),s("li",[e._v("Clean boot-args")]),e._v(" "),s("li",[e._v("Reboot and check your work")])]),e._v(" "),s("p",[e._v("Steps:")]),e._v(" "),s("h4",{attrs:{id:"_1-mount-root-partition-as-writable-macos-10-15"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-mount-root-partition-as-writable-macos-10-15"}},[e._v("#")]),e._v(" 1. Mount root partition as writable(macOS 10.15+)")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Big Sur+")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# First, create a mount point for your drive")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Skip of still present from mounting volume last time")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" ~/livemount\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Next, find your System volume")]),e._v("\ndiskutil list\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# From the below list, we can see our System volume is disk5s5")]),e._v("\n/dev/disk5 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("synthesized"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(":\n   "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#:                       TYPE NAME                    SIZE       IDENTIFIER")]),e._v("\n   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(":      APFS Container Scheme -                      +255.7 GB   disk5\n                                 Physical Store disk4s2\n   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(":                APFS Volume ⁨Big Sur HD - Data⁩       "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("122.5")]),e._v(" GB   disk5s1\n   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(":                APFS Volume ⁨Preboot⁩                 "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("309.4")]),e._v(" MB   disk5s2\n   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v(":                APFS Volume ⁨Recovery⁩                "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("887.8")]),e._v(" MB   disk5s3\n   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),e._v(":                APFS Volume ⁨VM⁩                      "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1.1")]),e._v(" MB     disk5s4\n   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("5")]),e._v(":                APFS Volume ⁨Big Sur HD⁩              "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("16.2")]),e._v(" GB    disk5s5\n   "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("6")]),e._v(":              APFS Snapshot ⁨com.apple.os.update-"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".⁩ "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("16.2")]),e._v(" GB    disk5s5s\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Mount the drive (ie. disk5s5)")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mount")]),e._v(" -o nobrowse -t apfs  /dev/disk5s5 ~/livemount\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Catalina only")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mount")]),e._v(" -uw /\n")])])]),s("h4",{attrs:{id:"_2-remove-debug-kernel-and-kexts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-remove-debug-kernel-and-kexts"}},[e._v("#")]),e._v(" 2. Remove debug kernel and kexts")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Revert to old snapshot (Big Sur+)")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" bless --mount ~/livemount --bootefi --last-sealed-snapshot\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Reset kernel cache (Catalina and older)")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("rm")]),e._v(" /System/Library/Caches/com.apple.kext.caches/Startup/kernelcache.de*\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("rm")]),e._v(" /System/Library/PrelinkedKernels/prelinkedkernel.de*\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" kextcache -invalidate /\n")])])]),s("h4",{attrs:{id:"_3-re-enable-sip"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-re-enable-sip"}},[e._v("#")]),e._v(" 3. Re-enable SIP")]),e._v(" "),s("ul",[s("li",[e._v("Recovery commands(if previously changed via recovery):")])]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("csrutil "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("enable")]),e._v("\ncsrutil authenticated-root "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("enable")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Big Sur+")]),e._v("\n")])])]),s("ul",[s("li",[e._v("config.plist changes(if previously changed via config.plist):\n"),s("ul",[s("li",[s("RouterLink",{attrs:{to:"/troubleshooting/extended/post-issues.html#disabling-sip"}},[e._v("Enabling via config.plist")])],1)])])]),e._v(" "),s("h4",{attrs:{id:"_4-clean-boot-args"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-clean-boot-args"}},[e._v("#")]),e._v(" 4. Clean boot-args")]),e._v(" "),s("p",[e._v("Don't forget to remove "),s("code",[e._v("kcsuffix=")]),e._v(" in your boot-args")]),e._v(" "),s("h4",{attrs:{id:"_5-reboot-and-check-your-work"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-reboot-and-check-your-work"}},[e._v("#")]),e._v(" 5. Reboot and check your work")]),e._v(" "),s("p",[e._v("Assuming everything was done correctly, you'll now want to reboot and check that the correct kernel was booted:")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("sysctl kern.osbuildconfig\n kern.osbuildconfig: release\n")])])]),s("p",[e._v("And as we can see, we're successfully booting a KASAN kernel.")])])}),[],!1,null,null,null);t.default=r.exports}}]);